@model IEnumerable<PlataformaEDUGEP.Models.Tag>

@{
    ViewData["Title"] = "Tags";
}

<h1>Etiquetas</h1>

<!-- Create Tag Button -->
<div class="d-flex justify-content-end mb-3">
    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#createTagModal">
        <i class="fas fa-plus"></i>
    </button>
</div>


<style>
    .custom-black-border td,
    .custom-black-border th {
        border: 1px solid black;
    }
</style>

<table class="table mt-3 table-bordered custom-black-border">
    <thead class="table-primary">
        <tr>
            <th class="text-center">
                @Html.DisplayNameFor(model => model.First().Name)
            </th>
            <th class="text-center">Ações</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td class="text-center">
                    @Html.DisplayFor(modelItem => item.Name)
                </td>
                <td class="text-center">
                    <!-- Edit Button with FontAwesome Icon -->
                    <a href="javascript:void(0)" class="btn btn-primary mx-1 btn-sm edit-tag-btn" data-id="@item.TagId" data-bs-toggle="modal" data-bs-target="#editTagModal">
                        <i class="fas fa-pencil-alt"></i>
                    </a>
                    <!-- The rest of your buttons like Delete can remain the same -->
                    <!-- Modify this line in your foreach loop for tags -->
                    <button class="btn btn-danger mx-1 btn-sm delete-tag-btn" data-id="@item.TagId" data-bs-toggle="modal" data-bs-target="#confirmDeleteTagModal"><i class="fas fa-trash"></i></button>
                </td>
            </tr>
        }
    </tbody>
</table>

<!-- Create Tag Modal -->
<div class="modal fade" id="createTagModal" tabindex="-1" aria-labelledby="createTagModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createTagModalLabel">Criar Nova Etiqueta</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- The form will be loaded here via JavaScript -->
            </div>
        </div>
    </div>
</div>

<!-- Edit Tag Modal -->
<div class="modal fade" id="editTagModal" tabindex="-1" aria-labelledby="editTagModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editTagModalLabel">Edit Tag</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Edit form will be loaded here -->
            </div>
        </div>
    </div>
</div>

<!-- Delete Tag Confirmation Modal -->
<div class="modal fade" id="confirmDeleteTagModal" tabindex="-1" aria-labelledby="confirmDeleteTagModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteTagModalLabel">Apagar Etiqueta</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Tem a certeza que deseja apagar esta etiqueta? Esta ação não pode ser desfeita.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-danger btn-delete-tag-confirm">Apagar Etiqueta</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        $(document).ready(function () {
            $('#createTagModal').on('show.bs.modal', function (e) {
                var url = '@Url.Action("Create", "Tags")'; // Adjust the URL as necessary
                $.get(url, function (data) {
                    $('#createTagModal .modal-body').html(data);
                });
            });
        });

        $(document).ready(function () {
            $(document).on('submit', '#createTagForm', function (e) {
                e.preventDefault();
                var form = $(this);
                $.ajax({
                    type: 'POST',
                    url: form.attr('action'),
                    data: form.serialize(),
                    success: function (response) {
                        // Handle success, e.g., close modal, refresh tags list
                        $('#createTagModal').modal('hide');
                        location.reload(); // Simple way to refresh the tags list
                    },
                    error: function (xhr, status, error) {
                        // Handle error
                        console.error("Error creating tag: ", xhr.responseText);
                    }
                });
            });
        });

        $(document).ready(function () {
            // Load Edit Form into Modal
            $('.edit-tag-btn').click(function () {
                var tagId = $(this).data('id');
                var url = '@Url.Action("Edit", "Tags")/' + tagId;
                $.get(url, function (data) {
                    $('#editTagModal .modal-body').html(data);
                });
            });

            // AJAX submission for Edit Form
            $(document).on('submit', '#editTagForm', function (e) {
                e.preventDefault();
                var form = $(this);
                $.ajax({
                    type: 'POST',
                    url: form.attr('action'),
                    data: form.serialize(),
                    success: function (response) {
                        $('#editTagModal').modal('hide');
                        location.reload(); // Or update the UI as needed
                    },
                    error: function (xhr, status, error) {
                        console.error("Error editing tag: ", xhr.responseText);
                    }
                });
            });
        });

        $(document).ready(function () {
            // Your existing JavaScript code...

            // Event handler for delete confirmation
            $('.delete-tag-btn').click(function () {
                var tagId = $(this).data('id');
                $('#confirmDeleteTagModal').data('id', tagId); // Store the tag ID in the modal
                $('#confirmDeleteTagModal').modal('show');
            });

            // AJAX submission for Delete
            $('#confirmDeleteTagModal').on('click', '.btn-delete-tag-confirm', function () {
                var tagId = $('#confirmDeleteTagModal').data('id'); // Ensure this retrieves the correct ID
                $.ajax({
                    type: 'POST',
                    url: '/Tags/Delete/' + tagId, // This should match your routing pattern
                    headers: {
                        "RequestVerificationToken": $('input[name="__RequestVerificationToken"]').val()
                    },
                    success: function (response) {
                        $('#confirmDeleteTagModal').modal('hide');
                        location.reload(); // Or any other logic to update the UI
                    },
                    error: function (xhr, status, error) {
                        console.error("Error deleting tag: ", xhr.responseText);
                    }
                });
            });
        });
    </script>

}
